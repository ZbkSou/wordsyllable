# 📚 新概念英语听力模块

## 功能概述

这是一个完整的新概念英语听力学习模块，支持第1-4册的课文学习。

### ✨ 核心功能

1. **课程目录** - 浏览4册教材的所有课程
2. **音频播放** - 播放课文音频，支持多种控制
3. **同步歌词** - LRC 格式的课文同步显示
4. **句子交互** - 点击句子跳转播放
5. **隐藏模式** - 纯听力训练
6. **单词查询** - 选中单词即可查询

---

## 数据来源

音频和课文资源来自 [nce.szsyw.cn](https://nce.szsyw.cn)

### URL 格式
```
音频: https://nce.szsyw.cn/NCE{册数}/{filename}.mp3
字幕: https://nce.szsyw.cn/NCE{册数}/{filename}.lrc
```

### LRC 格式示例
```
[al:新概念英语（二）]
[ar:MP3 同步字幕版（美音）]
[ti:Breakfast or Lunch?]
[00:10.47]Why was the writer's aunt surprised?|为什么作者的阿姨会感到惊讶呢？
[00:16.00]It was Sunday.|那是星期天。
```

---

## 组件结构

```
word-next/
├── app/nce/
│   ├── page.tsx              # NCE 主页面
│   └── README.md             # 本文档
├── components/
│   ├── NCELessonList.tsx     # 课程目录组件
│   ├── NCEPlayer.tsx         # 播放器组件
│   ├── NCESentence.tsx       # 句子组件
│   └── WordLookupPopup.tsx   # 单词查询弹窗
├── utils/
│   └── lrcParser.ts          # LRC 解析工具
└── public/
    └── nec_data.json         # 课程目录数据
```

---

## 功能详解

### 1. 播放控制

| 功能 | 操作 | 快捷键 |
|------|------|--------|
| 播放/暂停 | 点击播放按钮 | Space |
| 上一句 | 点击上一句按钮 | ← / A |
| 下一句 | 点击下一句按钮 | → / D |
| 重播当前句 | 点击重播按钮 | R |
| 跳转句子 | 点击句子 | - |
| 进度调节 | 拖动进度条 | - |

### 2. 播放模式

| 模式 | 说明 |
|------|------|
| 连读 | 顺序播放所有句子 |
| 单句循环 | 当前句子循环播放 |
| 整篇循环 | 整篇课文循环播放 |

### 3. 播放速度

支持 0.5x / 0.75x / 1x / 1.25x / 1.5x / 2x 六档速度调节

### 4. 显示模式

| 模式 | 说明 |
|------|------|
| 全部 | 显示英文和中文 |
| 隐藏中文 | 只显示英文 |
| 隐藏英文 | 只显示中文翻译 |
| 纯听力 | 隐藏所有文字，可点击显示 |

### 5. 听懂标记

在隐藏模式下，可以标记每句话：
- ✓ 听懂 - 绿色标记
- ✗ 没懂 - 红色标记

### 6. 单词查询

1. 选中英文单词
2. 自动弹出查询窗口
3. 显示单词信息：
   - 音标
   - 翻译
   - 音节
   - 自然拼读解析
   - 词根词缀

---

## 使用指南

### 1. 选择课程

```
1. 访问 /nce 页面
2. 选择册数（1-4册）
3. 点击想学习的课程
```

### 2. 听力学习

```
1. 点击播放按钮开始播放
2. 句子会自动高亮并滚动
3. 点击任意句子可跳转播放
4. 使用速度控制调整播放速度
```

### 3. 听写训练

```
1. 选择"隐藏英文"或"纯听力"模式
2. 听音频，尝试理解句子
3. 点击句子可临时显示文字（3秒后自动隐藏）
4. 标记"听懂"或"没懂"
```

### 4. 单词学习

```
1. 听到不认识的单词
2. 用鼠标选中该单词
3. 查看弹出的单词详情
4. 单词会自动添加到你的单词库
```

---

## 界面预览

### 课程目录
```
┌─────────────────────────────────────────┐
│ 📚 新概念英语听力                        │
│ [第1册] [第2册] [第3册] [第4册]          │
├─────────────────────────────────────────┤
│ 新概念英语 第2册                         │
│ Practice & Progress                      │
│ 共 96 课                                 │
├─────────────────────────────────────────┤
│ 🔍 搜索课程...                           │
├─────────────────────────────────────────┤
│ [01] A Private Conversation         ▶  │
│ [02] Breakfast or Lunch             ▶  │
│ [03] Please Send Me a Card          ▶  │
│ ...                                     │
└─────────────────────────────────────────┘
```

### 播放器界面
```
┌─────────────────────────────────────────┐
│ ← 返回目录    📚 新概念英语听力          │
├─────────────────────────────────────────┤
│ Breakfast or Lunch?                      │
│ 第 2 册 • 17 句 • 01:15                  │
├─────────────────────────────────────────┤
│ 00:16 ━━━━━━●━━━━━━━━━━━━━━━━━━ 01:15   │
│      ⏮ ⏸ ⏭ 🔄                          │
│ 速度: [0.5] [0.75] [1x] [1.25] [1.5]    │
│ 模式: [连读] [单句循环] [整篇循环]        │
│ 显示: [全部] [隐藏中文] [隐藏英文] [纯听力]│
├─────────────────────────────────────────┤
│ 01 [00:10.47]                            │
│ Why was the writer's aunt surprised?     │
│ 为什么作者的阿姨会感到惊讶呢？            │
├─────────────────────────────────────────┤
│ 02 [00:16.00] ▶ 正在播放                 │
│ It was Sunday.                           │█
│ 那是星期天。                              │█
├─────────────────────────────────────────┤
│ 03 [00:17.99]                            │
│ I never get up early on Sundays.         │
│ 我从来不在周日早起。                      │
└─────────────────────────────────────────┘
```

### 隐藏模式
```
┌─────────────────────────────────────────┐
│ 02 [00:16.00]                            │
│ 🔒 点击显示英文           [✓ 听懂][✗ 没懂]│
│ 🔒 点击显示中文                          │
└─────────────────────────────────────────┘
```

### 单词查询弹窗
```
┌─────────────────────────────────────────┐
│ 📖 surprised                    已添加 ✕│
├─────────────────────────────────────────┤
│ /səˈpraɪzd/                             │
│ 惊讶的，吃惊的                           │
│                                         │
│ 音节: [sur] [prised]                    │
│                                         │
│ 📘 自然拼读                              │
│ ┃ sur-元音ur组合/sə/，                   │
│ ┃ prised-长元音i/praɪzd/                │
│                                         │
│ 🟧 词根词缀                              │
│ ┃ 词根surprise(惊讶)，                   │
│ ┃ 后缀-ed(形容词后缀)                    │
├─────────────────────────────────────────┤
│ 按 Esc 或点击外部关闭                    │
└─────────────────────────────────────────┘
```

---

## 技术实现

### LRC 解析

```typescript
// 解析时间戳
function parseTimeToSeconds(timeStr: string): number {
  const match = timeStr.match(/(\d+):(\d+)\.(\d+)/);
  const minutes = parseInt(match[1], 10);
  const seconds = parseInt(match[2], 10);
  const hundredths = parseInt(match[3], 10);
  return minutes * 60 + seconds + hundredths / 100;
}

// 解析 LRC 行
// 格式: [mm:ss.xx]English text|中文翻译
const parts = content.split('|');
const english = parts[0]?.trim();
const chinese = parts[1]?.trim();
```

### 播放同步

```typescript
// 根据当前时间获取当前行
function getCurrentLineIndex(lines: LrcLine[], currentTime: number): number {
  for (let i = lines.length - 1; i >= 0; i--) {
    if (currentTime >= lines[i].time) {
      return i;
    }
  }
  return -1;
}
```

### 单词选择检测

```typescript
const handleMouseUp = (e: React.MouseEvent) => {
  const selection = window.getSelection();
  const selectedText = selection?.toString().trim();
  
  // 只处理英文单词
  if (selectedText && /^[a-zA-Z'-]+$/.test(selectedText)) {
    onTextSelect(selectedText, e.clientX, e.clientY);
  }
};
```

---

## API 依赖

### 单词查询接口

```typescript
// POST /api/words/lookup
wordsAPI.lookupWord({ word: 'surprised' })

// 返回格式
{
  "message": "单词已存在",
  "action": "queried",
  "word": {
    "id": 1,
    "word": "surprised",
    "translation": "惊讶的",
    "phonetic": "/səˈpraɪzd/",
    "phonetic_analysis": "...",
    "root_affix": "...",
    "syllables": ["sur", "prised"]
  }
}
```

---

## 键盘快捷键

| 按键 | 功能 |
|------|------|
| `Space` | 播放/暂停 |
| `←` / `A` | 上一句 |
| `→` / `D` | 下一句 |
| `R` | 重播当前句 |
| `Esc` | 关闭单词弹窗 |

---

## 浏览器兼容性

- ✅ Chrome 80+
- ✅ Firefox 75+
- ✅ Safari 13+
- ✅ Edge 80+

---

## 常见问题

### Q1: 音频无法播放？
**A:** 检查网络连接，音频来自 nce.szsyw.cn

### Q2: 课文不显示？
**A:** LRC 文件可能加载失败，刷新页面重试

### Q3: 单词查询不工作？
**A:** 确保已登录系统，接口需要认证

### Q4: 自动滚动不流畅？
**A:** 可以关闭"自动滚动"选项手动控制

---

## 更新日志

### v1.0.0 (2025-11-19)

- ✨ 新增新概念英语听力模块
- ✨ 支持4册教材的课程目录
- ✨ 实现 LRC 同步歌词
- ✨ 添加多种播放模式
- ✨ 实现隐藏模式和听懂标记
- ✨ 集成单词查询功能
- ✨ 添加键盘快捷键
- 🎨 深色主题 UI 设计

---

## 致谢

- 音频资源：[nce.szsyw.cn](https://nce.szsyw.cn)
- 课程数据：新概念英语系列教材

---

## 联系支持

如有问题或建议，请查看项目文档或联系技术支持。

**祝学习愉快！** 📚✨

